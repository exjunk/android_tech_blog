{{/* layouts/partials/analytics.html */}}
{{/* Usage: include this partial inside <head> of baseof.html */}}

{{ if and (isset .Site.Params "analytics_provider") (ne .Site.Params.analytics_provider "") }}
  {{ if hugo.IsProduction }}
    {{ $provider := lower .Site.Params.analytics_provider }}

    {{ if eq $provider "ga4" }}
      {{ $ga := .Site.Params.ga4_measurement_id | default "" }}
      {{ if ne $ga "" }}
        <!-- Google Analytics 4 -->
        <script async src="https://www.googletagmanager.com/gtag/js?id={{ $ga }}"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', '{{ $ga }}', { 'anonymize_ip': true });
        </script>
      {{ else }}
        <!-- GA4 measurement ID not set in config -->
      {{ end }}

    {{ else if eq $provider "plausible" }}
      {{ $domain := .Site.Params.plausible_domain | default "" }}
      {{ if ne $domain "" }}
        <!-- Plausible Analytics -->
        {{ $script_url := .Site.Params.plausible_script_url | default "https://plausible.io/js/script.js" }}
        <script defer data-domain="{{ $domain }}" src="{{ $script_url }}"></script>
      {{ else }}
        <!-- Plausible domain not set in config -->
      {{ end }}

    {{ else }}
      <!-- Unsupported analytics provider: {{ $provider }} -->
    {{ end }}
  {{ else }}
    {{/* Not production build â€” analytics disabled */}}
  {{ end }}
{{ end }}
